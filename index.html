<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ada çš„ Solana ç„¡æå½©ç¥¨æ¨¡æ“¬ (PoolTogether-like)</title>
    <!-- å¼•å…¥ Tailwind CSS ç”¨æ–¼ç¾è§€å’ŒéŸ¿æ‡‰å¼è¨­è¨ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­å®šå…¨åŸŸå­—é«”ç‚º Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* è¼•å¾®çš„èƒŒæ™¯è‰² */
        }
        .text-gradient {
            background-image: linear-gradient(to right, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">
    <!-- ä¸»å®¹å™¨ï¼Œç½®ä¸­ä¸¦å¸¶æœ‰é™°å½±å’Œåœ“è§’ -->
    <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 w-full max-w-md">
        <!-- æ‡‰ç”¨ç¨‹å¼æ¨™é¡Œ -->
        <h1 class="text-3xl font-bold text-center text-gradient mb-6">Solana ç„¡æå½©ç¥¨æ¨¡æ“¬</h1>

        <!-- é€£æ¥éŒ¢åŒ…å€å¡Š -->
        <div class="mb-6 text-center">
            <button id="connectWalletButton" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out shadow-md">
                é€£æ¥ Phantom éŒ¢åŒ…
            </button>
            <p id="walletStatus" class="mt-3 text-sm text-gray-600"></p>
            <p id="walletAddress" class="mt-1 text-sm text-gray-800 font-mono break-all"></p>
        </div>

        <!-- é¤˜é¡æ¦‚è¦½å€å¡Š -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-indigo-50 p-4 rounded-lg shadow-sm">
                <h2 class="text-xl font-semibold text-indigo-700 mb-2">éŒ¢åŒ…å¯ç”¨ SOL</h2>
                <p class="text-3xl font-extrabold text-indigo-900" id="solBalance">0.0000 SOL</p>
                <p class="text-gray-500 text-sm mt-1">ä¾†è‡ª Solana Devnet</p>
            </div>
            <div class="bg-emerald-50 p-4 rounded-lg shadow-sm">
                <h2 class="text-xl font-semibold text-emerald-700 mb-2">æˆ‘çš„å­˜æ¬¾ (æ¨¡æ“¬)</h2>
                <p class="text-3xl font-extrabold text-emerald-900" id="myDeposits">0.0000 SOL</p>
                <p class="text-500 text-sm mt-1">å·²å­˜å…¥ç„¡æå½©ç¥¨æ± </p>
            </div>
        </div>

        <!-- çæ± è³‡è¨Šèˆ‡é–‹çå€’æ•¸ -->
        <div class="bg-purple-50 p-4 rounded-lg mb-6 shadow-sm text-center">
            <h2 class="text-2xl font-bold text-purple-700 mb-2">ç•¶å‰çæ± ç¸½é¡ (æ¨¡æ“¬)</h2>
            <p class="text-5xl font-extrabold text-purple-900 mb-4" id="prizePool">0.00 SOL</p>
            <h3 class="text-xl font-semibold text-purple-600 mb-2">è·é›¢ä¸‹æ¬¡é–‹ç</h3>
            <p class="text-3xl font-bold text-purple-800" id="countdown">--:--</p>
        </div>

        <!-- å­˜å…¥èˆ‡æé ˜æ“ä½œå€å¡Š -->
        <div class="border-t border-gray-200 pt-6 mt-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">å­˜å…¥èˆ‡æé ˜ SOL</h2>
            <div class="space-y-4">
                <!-- å­˜å…¥ SOL -->
                <div class="flex flex-col md:flex-row gap-2">
                    <input type="number" id="depositAmount" placeholder="å­˜å…¥é‡‘é¡ (SOL)" step="0.000000001" min="0.000000001"
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    <button id="depositButton" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out shadow-md" disabled>
                        å­˜å…¥
                    </button>
                </div>
                <!-- æé ˜ SOL -->
                <div class="flex flex-col md:flex-row gap-2">
                    <input type="number" id="withdrawAmount" placeholder="æé ˜é‡‘é¡ (SOL)" step="0.000000001" min="0.000000001"
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-150 ease-in-out">
                    <button id="withdrawButton" class="w-full md:w-auto bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-150 ease-in-out shadow-md" disabled>
                        æé ˜
                    </button>
                </div>
            </div>
        </div>

        <!-- é ˜å–çå‹µå€å¡Š -->
        <div class="border-t border-gray-200 pt-6 mt-6 text-center">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">é ˜å–æˆ‘çš„çå‹µ</h2>
            <p id="prizeMessage" class="text-lg text-orange-600 font-bold mb-4 hidden">ğŸ‰ æ­å–œæ‚¨ä¸­çäº†ï¼</p>
            <button id="claimPrizeButton" class="w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition duration-150 ease-in-out shadow-md" disabled>
                é ˜å–çå‹µ
            </button>
        </div>

        <!-- è¨Šæ¯é¡¯ç¤ºå€å¡Šï¼ˆæˆåŠŸ/å¤±æ•—/æç¤ºï¼‰ -->
        <p id="message" class="mt-4 text-center text-sm font-medium"></p>

        <!-- æ‡‰ç”¨ç¨‹å¼å…è²¬è²æ˜ -->
        <p class="text-xs text-gray-400 text-center mt-6">
            æ­¤æ‡‰ç”¨ç¨‹å¼é€£æ¥åˆ° Solana Devnetã€‚è«‹ç¢ºä¿æ‚¨çš„ Phantom éŒ¢åŒ…å·²å®‰è£ä¸¦è¨­ç½®ç‚º Devnetã€‚<br>
            **çæ± ã€å­˜æ¬¾å’Œä¸­çé‚è¼¯ç‚ºå‰ç«¯æ¨¡æ“¬ï¼Œç›¸é—œæ“ä½œæœƒè§¸ç™¼çœŸå¯¦çš„ Phantom äº¤æ˜“ï¼ˆæ¥µå°é‡‘é¡è½‰å¸³çµ¦è‡ªå·±ï¼‰ä¾†æ¨¡æ“¬éˆä¸Šäº’å‹•ã€‚**
        </p>
    </div>

    <!-- å¼•å…¥ Solana Web3.js å‡½å¼åº« -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

    <script>
        // ç¢ºä¿ Solana Web3.js å‡½å¼åº«å·²è¼‰å…¥
        const { Connection, PublicKey, Transaction, SystemProgram } = solanaWeb3;

        // è¨­å®š Solana ç¶²è·¯ (Devnet æ˜¯é–‹ç™¼æ¸¬è©¦ç¶²è·¯)
        const network = solanaWeb3.clusterApiUrl('devnet');
        const connection = new Connection(network, 'confirmed');

        // ç²å– DOM å…ƒç´ 
        const connectWalletButton = document.getElementById('connectWalletButton');
        const walletStatusElement = document.getElementById('walletStatus');
        const walletAddressElement = document.getElementById('walletAddress');
        const solBalanceElement = document.getElementById('solBalance');
        const myDepositsElement = document.getElementById('myDeposits'); // æˆ‘çš„å­˜æ¬¾é¡¯ç¤ºå…ƒç´ 
        const prizePoolElement = document.getElementById('prizePool'); // çæ± é¡¯ç¤ºå…ƒç´ 
        const countdownElement = document.getElementById('countdown'); // å€’æ•¸è¨ˆæ™‚é¡¯ç¤ºå…ƒç´ 
        const depositAmountInput = document.getElementById('depositAmount'); // å­˜å…¥é‡‘é¡è¼¸å…¥
        const depositButton = document.getElementById('depositButton'); // å­˜å…¥æŒ‰éˆ•
        const withdrawAmountInput = document.getElementById('withdrawAmount'); // æé ˜é‡‘é¡è¼¸å…¥
        const withdrawButton = document.getElementById('withdrawButton'); // æé ˜æŒ‰éˆ•
        const prizeMessageElement = document.getElementById('prizeMessage'); // ä¸­çè¨Šæ¯
        const claimPrizeButton = document.getElementById('claimPrizeButton'); // é ˜å–çå‹µæŒ‰éˆ•
        const messageElement = document.getElementById('message');

        // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹è®Šæ•¸
        let provider = null; // Phantom éŒ¢åŒ…æä¾›è€…
        let walletPublicKey = null; // é€£æ¥çš„éŒ¢åŒ…å…¬é–‹é‡‘é‘°
        let currentAvailableSolBalance = 0; // éŒ¢åŒ…ä¸­å¯ç”¨çš„ SOL é¤˜é¡ (ä¾†è‡ª Devnet)
        let mySimulatedDeposits = 0; // ç”¨æˆ¶åœ¨çæ± ä¸­çš„æ¨¡æ“¬å­˜æ¬¾
        let simulatedPrizePoolAmount = 5.0; // æ¨¡æ“¬çš„çæ± ç¸½é¡ï¼Œåˆå§‹å€¼ 5 SOL
        const WINNING_PRIZE_AMOUNT = 0.5; // æ¯æ¬¡ä¸­ççé‡‘ (æ¨¡æ“¬)
        const DRAW_INTERVAL_SECONDS = 60; // æ¯ 60 ç§’é–‹çä¸€æ¬¡ (æ¨¡æ“¬)
        let nextDrawTime = Date.now() + DRAW_INTERVAL_SECONDS * 1000; // ä¸‹æ¬¡é–‹çæ™‚é–“
        let drawIntervalId = null; // å€’æ•¸è¨ˆæ™‚å™¨ ID
        let userHasWon = false; // ç”¨æˆ¶æ˜¯å¦ä¸­ç (æ¨¡æ“¬)

        // å‡½æ•¸ï¼šé¡¯ç¤ºè¨Šæ¯
        function showMessage(msg, colorClass) {
            messageElement.textContent = msg;
            messageElement.className = `mt-4 text-center text-sm font-medium ${colorClass}`;
        }

        // å‡½æ•¸ï¼šå•Ÿç”¨æˆ–ç¦ç”¨æ‰€æœ‰ä¸»è¦æ“ä½œæŒ‰éˆ• (ä¾‹å¦‚åœ¨äº¤æ˜“é€²è¡Œä¸­æ™‚)
        function toggleAllActionButtons(enable) {
            depositButton.disabled = !enable;
            withdrawButton.disabled = !enable;
            claimPrizeButton.disabled = !enable; // ç¢ºä¿çå‹µæŒ‰éˆ•åœ¨äº¤æ˜“æ™‚ä¹Ÿè¢«ç¦ç”¨
            // ç™¼é€æŒ‰éˆ•å·²ç§»é™¤ï¼Œç„¡éœ€åœ¨æ­¤è™•æ§åˆ¶
        }

        // å‡½æ•¸ï¼šæ›´æ–°æ‰€æœ‰ UI å…ƒç´ 
        async function updateUI() {
            // æ›´æ–°å¯ç”¨ SOL é¤˜é¡
            if (walletPublicKey) {
                try {
                    const balanceLamports = await connection.getBalance(walletPublicKey);
                    currentAvailableSolBalance = balanceLamports / solanaWeb3.LAMPORTS_PER_SOL;
                    solBalanceElement.textContent = currentAvailableSolBalance.toFixed(4) + ' SOL';
                } catch (error) {
                    console.error('ç²å–å¯ç”¨é¤˜é¡å¤±æ•—:', error);
                    solBalanceElement.textContent = 'éŒ¯èª¤';
                    currentAvailableSolBalance = 0;
                }
            } else {
                solBalanceElement.textContent = '0.0000 SOL';
                currentAvailableSolBalance = 0;
            }

            // æ›´æ–°æˆ‘çš„å­˜æ¬¾
            myDepositsElement.textContent = mySimulatedDeposits.toFixed(4) + ' SOL';

            // æ›´æ–°çæ± ç¸½é¡
            prizePoolElement.textContent = simulatedPrizePoolAmount.toFixed(2) + ' SOL';

            // æ›´æ–°é ˜å–çå‹µæŒ‰éˆ•ç‹€æ…‹ (åŸºæ–¼æ˜¯å¦ä¸­çåŠæ˜¯å¦å·²é€£æ¥éŒ¢åŒ…)
            if (userHasWon && walletPublicKey) { // åªæœ‰ä¸­çä¸”å·²é€£æ¥æ™‚æ‰å•Ÿç”¨
                prizeMessageElement.classList.remove('hidden');
                claimPrizeButton.disabled = false;
            } else {
                prizeMessageElement.classList.add('hidden');
                claimPrizeButton.disabled = true;
            }

            // æ ¹æ“šé€£æ¥ç‹€æ…‹å•Ÿç”¨/ç¦ç”¨å­˜å…¥å’Œæé ˜æŒ‰éˆ•
            const isConnected = walletPublicKey !== null;
            depositButton.disabled = !isConnected;
            withdrawButton.disabled = !isConnected;
            // æ³¨æ„ï¼šdepositButton å’Œ withdrawButton åœ¨æ­¤è™•è¨­ç½®ç‚ºåŸºæ–¼é€£æ¥ç‹€æ…‹ï¼Œ
            // ä½†åœ¨å¯¦éš›äº¤æ˜“éç¨‹ä¸­æœƒè¢« toggleAllActionButtons æš«æ™‚ç¦ç”¨ã€‚
        }

        // å‡½æ•¸ï¼šæ›´æ–°é–‹çå€’æ•¸è¨ˆæ™‚
        function updateCountdown() {
            const now = Date.now();
            const timeLeft = nextDrawTime - now;

            if (timeLeft <= 0) {
                countdownElement.textContent = 'æ­£åœ¨é–‹ç...';
                clearInterval(drawIntervalId); // åœæ­¢å€’æ•¸
                performPrizeDraw(); // åŸ·è¡Œé–‹çé‚è¼¯
                nextDrawTime = now + DRAW_INTERVAL_SECONDS * 1000; // é‡ç½®ä¸‹æ¬¡é–‹çæ™‚é–“
                drawIntervalId = setInterval(updateCountdown, 1000); // é‡æ–°å•Ÿå‹•å€’æ•¸
            } else {
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // å‡½æ•¸ï¼šåŸ·è¡Œæ¨¡æ“¬é–‹çé‚è¼¯
        function performPrizeDraw() {
            showMessage('æ­£åœ¨é€²è¡Œé–‹ç...', 'text-gray-600');
            // æ¨¡æ“¬ä¸­çé‚è¼¯ï¼šå¦‚æœç”¨æˆ¶æœ‰å­˜æ¬¾ï¼Œå‰‡æœ‰ 20% çš„æ©Ÿç‡ä¸­ç
            if (mySimulatedDeposits > 0 && Math.random() < 0.2) {
                userHasWon = true;
                showMessage('æ­å–œï¼æ‚¨ä¸­çäº†ï¼è«‹é ˜å–æ‚¨çš„çå‹µã€‚', 'text-green-600');
            } else {
                userHasWon = false;
                showMessage('æœ¬æ¬¡æ‚¨æœªä¸­çã€‚ä¸‹æ¬¡é–‹çè¦‹ï¼', 'text-gray-600');
            }
            updateUI(); // æ›´æ–° UI ä»¥é¡¯ç¤ºä¸­çç‹€æ…‹
        }

        // å‡½æ•¸ï¼šæª¢æŸ¥ Phantom éŒ¢åŒ…æ˜¯å¦å¯ç”¨
        function getProvider() {
            if ('solana' in window) {
                const solanaWindow = window.solana;
                if (solanaWindow.isPhantom) {
                    return solanaWindow;
                }
            }
            window.open('https://phantom.app/', '_blank');
            return null;
        }

        // å‡½æ•¸ï¼šåŸ·è¡Œéˆä¸Š dummy äº¤æ˜“ (æ¨¡æ“¬äº’å‹•)
        async function performDummyTransaction(actionName) {
            if (!walletPublicKey) {
                showMessage('è«‹å…ˆé€£æ¥éŒ¢åŒ…ã€‚', 'text-red-600');
                return false;
            }
            // ç™¼é€ä¸€å€‹æ¥µå°é‡‘é¡ (1 Lamport) çš„è½‰å¸³çµ¦è‡ªå·±ï¼Œä»¥è§¸ç™¼ Phantom ç°½å
            const dummyLamports = 1;
            try {
                const transaction = new Transaction().add(
                    SystemProgram.transfer({
                        fromPubkey: walletPublicKey,
                        toPubkey: walletPublicKey, // è½‰å¸³çµ¦è‡ªå·±
                        lamports: dummyLamports,
                    })
                );
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                transaction.feePayer = walletPublicKey;

                showMessage(`æ­£åœ¨ç­‰å¾… Phantom æ‰¹å‡† ${actionName} äº¤æ˜“...`, 'text-gray-600');

                const signedTransaction = await provider.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());

                showMessage(`${actionName} äº¤æ˜“å·²ç™¼é€ï¼ç°½å: ${signature}. ç­‰å¾…ç¢ºèª...`, 'text-blue-600');

                await connection.confirmTransaction(signature);
                showMessage(`${actionName} äº¤æ˜“æˆåŠŸï¼ç°½å: ${signature}.`, 'text-green-600');
                return true;
            } catch (error) {
                console.error(`${actionName} äº¤æ˜“å¤±æ•—:`, error);
                if (error.code === 4001) {
                    showMessage(`ç”¨æˆ¶æ‹’çµ• ${actionName} äº¤æ˜“ã€‚`, 'text-red-600');
                } else if (error.message.includes('insufficient funds')) {
                    showMessage('å¯ç”¨è³‡é‡‘ä¸è¶³ä»¥æ”¯ä»˜äº¤æ˜“è²»ã€‚', 'text-red-600');
                } else {
                    showMessage(`${actionName} äº¤æ˜“æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'text-red-600');
                }
                return false;
            }
        }

        // é»æ“Šã€Œé€£æ¥ Phantom éŒ¢åŒ…ã€æŒ‰éˆ•
        connectWalletButton.addEventListener('click', async () => {
            provider = getProvider();
            if (!provider) {
                showMessage('è«‹å®‰è£ Phantom éŒ¢åŒ…ã€‚', 'text-red-600');
                return;
            }

            try {
                const resp = await provider.connect();
                walletPublicKey = resp.publicKey;

                walletStatusElement.textContent = 'éŒ¢åŒ…å·²é€£æ¥ï¼';
                walletStatusElement.className = 'mt-3 text-sm text-green-600';
                walletAddressElement.textContent = walletPublicKey.toString();
                connectWalletButton.disabled = true;
                updateUI(); // é€£æ¥æˆåŠŸå¾Œç«‹å³æ›´æ–°æ‰€æœ‰ UI å…ƒç´ 

                // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚å™¨
                if (!drawIntervalId) {
                    drawIntervalId = setInterval(updateCountdown, 1000);
                }

                // ç›£è½ Phantom çš„æ–·é–‹é€£æ¥äº‹ä»¶
                provider.on('disconnect', () => {
                    walletPublicKey = null;
                    walletAddressElement.textContent = '';
                    walletStatusElement.textContent = 'éŒ¢åŒ…å·²æ–·é–‹é€£æ¥ã€‚';
                    walletStatusElement.className = 'mt-3 text-sm text-red-600';
                    clearInterval(drawIntervalId); // åœæ­¢å€’æ•¸
                    drawIntervalId = null;
                    mySimulatedDeposits = 0; // é‡ç½®å­˜æ¬¾
                    userHasWon = false; // é‡ç½®ä¸­çç‹€æ…‹
                    updateUI(); // æ¸…ç©ºæ‰€æœ‰é¤˜é¡å’Œç‹€æ…‹
                    connectWalletButton.disabled = false;
                });

            } catch (err) {
                console.error('é€£æ¥éŒ¢åŒ…å¤±æ•—:', err);
                if (err.code === 4001) {
                    showMessage('ç”¨æˆ¶æ‹’çµ•é€£æ¥éŒ¢åŒ…ã€‚', 'text-red-600');
                } else {
                    showMessage('é€£æ¥éŒ¢åŒ…æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚', 'text-red-600');
                }
            }
        });

        // é»æ“Šã€Œå­˜å…¥ã€æŒ‰éˆ• (è§¸ç™¼çœŸå¯¦ Phantom äº¤æ˜“ï¼Œä½†å­˜æ¬¾é‚è¼¯ç‚ºæœ¬æ©Ÿæ¨¡æ“¬)
        depositButton.addEventListener('click', async () => {
            const depositAmount = parseFloat(depositAmountInput.value);

            if (isNaN(depositAmount) || depositAmount <= 0) {
                showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„å­˜å…¥é‡‘é¡ã€‚', 'text-red-600');
                return;
            }
            if (depositAmount > currentAvailableSolBalance) {
                showMessage('å¯ç”¨é¤˜é¡ä¸è¶³ä»¥å­˜å…¥ã€‚', 'text-red-600');
                return;
            }

            toggleAllActionButtons(false); // ç¦ç”¨æ‰€æœ‰ä¸»è¦æŒ‰éˆ•
            depositButton.textContent = 'å­˜å…¥ä¸­ (ç­‰å¾…æ‰¹å‡†)...';

            const success = await performDummyTransaction('å­˜å…¥');
            if (success) {
                mySimulatedDeposits += depositAmount; // å¢åŠ æˆ‘çš„å­˜æ¬¾ (æ¨¡æ“¬)
                simulatedPrizePoolAmount += depositAmount; // å¢åŠ çæ± ç¸½é¡ (æ¨¡æ“¬)
                depositAmountInput.value = '';
                updateUI();
            }
            toggleAllActionButtons(true); // é‡æ–°å•Ÿç”¨æ‰€æœ‰ä¸»è¦æŒ‰éˆ•
            depositButton.textContent = 'å­˜å…¥';
        });

        // é»æ“Šã€Œæé ˜ã€æŒ‰éˆ• (è§¸ç™¼çœŸå¯¦ Phantom äº¤æ˜“ï¼Œä½†æé ˜é‚è¼¯ç‚ºæœ¬æ©Ÿæ¨¡æ“¬)
        withdrawButton.addEventListener('click', async () => {
            const withdrawAmount = parseFloat(withdrawAmountInput.value);

            if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
                showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„æé ˜é‡‘é¡ã€‚', 'text-red-600');
                return;
            }
            if (withdrawAmount > mySimulatedDeposits) {
                showMessage('æˆ‘çš„å­˜æ¬¾é¤˜é¡ä¸è¶³ä»¥æé ˜ã€‚', 'text-red-600');
                return;
            }

            toggleAllActionButtons(false); // ç¦ç”¨æ‰€æœ‰ä¸»è¦æŒ‰éˆ•
            withdrawButton.textContent = 'æé ˜ä¸­ (ç­‰å¾…æ‰¹å‡†)...';

            const success = await performDummyTransaction('æé ˜');
            if (success) {
                mySimulatedDeposits -= withdrawAmount; // æ¸›å°‘æˆ‘çš„å­˜æ¬¾ (æ¨¡æ“¬)
                simulatedPrizePoolAmount -= withdrawAmount; // æ¸›å°‘çæ± ç¸½é¡ (æ¨¡æ“¬)
                withdrawAmountInput.value = '';
                updateUI();
            }
            toggleAllActionButtons(true); // é‡æ–°å•Ÿç”¨æ‰€æœ‰ä¸»è¦æŒ‰éˆ•
            withdrawButton.textContent = 'æé ˜';
        });

        // é»æ“Šã€Œé ˜å–çå‹µã€æŒ‰éˆ• (è§¸ç™¼çœŸå¯¦ Phantom äº¤æ˜“ï¼Œä½†é ˜å–é‚è¼¯ç‚ºæœ¬æ©Ÿæ¨¡æ“¬)
        claimPrizeButton.addEventListener('click', async () => {
            if (!userHasWon) {
                showMessage('ç›®å‰æ²’æœ‰å¯é ˜å–çš„çå‹µã€‚', 'text-red-600');
                return;
            }

            toggleAllActionButtons(false); // ç¦ç”¨æ‰€æœ‰ä¸»è¦æŒ‰éˆ•
            claimPrizeButton.textContent = 'é ˜å–ä¸­ (ç­‰å¾…æ‰¹å‡†)...';

            const success = await performDummyTransaction('é ˜å–çå‹µ');
            if (success) {
                // æ¨¡æ“¬å°‡çé‡‘åŠ å…¥å¯ç”¨é¤˜é¡
                currentAvailableSolBalance += WINNING_PRIZE_AMOUNT; // é›–ç„¶é€™è£¡å¾ Devnet åˆ·æ–°äº†ï¼Œä½†é€™æ˜¯æ¨¡æ“¬çš„çé‡‘å¢åŠ 
                simulatedPrizePoolAmount -= WINNING_PRIZE_AMOUNT; // çæ± æ¸›å°‘
                userHasWon = false; // é‡ç½®ä¸­çç‹€æ…‹

                updateUI();
            }
            toggleAllActionButtons(true); // é‡æ–°å•Ÿç”¨æ‰€æœ‰ä¸»è¦æŒ‰éˆ•
            claimPrizeButton.textContent = 'é ˜å–çå‹µ';
        });

        // æ‡‰ç”¨ç¨‹å¼è¼‰å…¥å®Œæˆæ™‚ï¼Œæª¢æŸ¥ Phantom æ˜¯å¦å­˜åœ¨ä¸¦è¨­å®šåˆå§‹ç‹€æ…‹
        document.addEventListener('DOMContentLoaded', () => {
            if (getProvider()) {
                walletStatusElement.textContent = 'Phantom éŒ¢åŒ…å·²å®‰è£ã€‚è«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•é€£æ¥ã€‚';
                walletStatusElement.className = 'mt-3 text-sm text-green-600';
            } else {
                walletStatusElement.textContent = 'è«‹å®‰è£ Phantom éŒ¢åŒ…ã€‚';
                walletStatusElement.className = 'mt-3 text-sm text-red-600';
                connectWalletButton.disabled = true;
            }
            updateUI(); // åˆå§‹åŒ–æ‰€æœ‰ UI å…ƒç´ 
            updateCountdown(); // å•Ÿå‹•ç¬¬ä¸€æ¬¡å€’æ•¸é¡¯ç¤º
        });
    </script>
</body>
</html>
